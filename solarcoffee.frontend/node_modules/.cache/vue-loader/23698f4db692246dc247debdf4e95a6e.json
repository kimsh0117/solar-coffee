{"remainingRequest":"/Users/kimsanghun/Documents/SolarCoffee/solarcoffee.frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/kimsanghun/Documents/SolarCoffee/solarcoffee.frontend/src/views/CreateInvoice.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/Users/kimsanghun/Documents/SolarCoffee/solarcoffee.frontend/src/views/CreateInvoice.vue","mtime":1615630360550},{"path":"/Users/kimsanghun/Documents/SolarCoffee/solarcoffee.frontend/node_modules/cache-loader/dist/cjs.js","mtime":1615150631837},{"path":"/Users/kimsanghun/Documents/SolarCoffee/solarcoffee.frontend/node_modules/babel-loader/lib/index.js","mtime":1615150631849},{"path":"/Users/kimsanghun/Documents/SolarCoffee/solarcoffee.frontend/node_modules/ts-loader/index.js","mtime":1615150637072},{"path":"/Users/kimsanghun/Documents/SolarCoffee/solarcoffee.frontend/node_modules/cache-loader/dist/cjs.js","mtime":1615150631837},{"path":"/Users/kimsanghun/Documents/SolarCoffee/solarcoffee.frontend/node_modules/vue-loader/lib/index.js","mtime":1615150641385}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCmltcG9ydCB7IENvbXBvbmVudCwgVnVlIH0gZnJvbSAidnVlLXByb3BlcnR5LWRlY29yYXRvciI7CmltcG9ydCB7IEludm9pY2UsIExpbmVJdGVtIH0gZnJvbSAiQC90eXBlcy9JbnZvaWNlIjsKaW1wb3J0IHsgQ3VzdG9tZXIgfSBmcm9tICJAL3R5cGVzL0N1c3RvbWVyIjsKaW1wb3J0IHsgUHJvZHVjdEludmVudG9yeSB9IGZyb20gIkAvdHlwZXMvUHJvZHVjdCI7CmltcG9ydCB7IEN1c3RvbWVyU2VydmljZSwgSW52ZW50b3J5U2VydmljZSwgSW52b2ljZVNlcnZpY2UgfSBmcm9tICJAL3NlcnZpY2VzIjsKaW1wb3J0IFNvbGFyQnV0dG9uIGZyb20gIkAvY29tcG9uZW50cy9Tb2xhckJ1dHRvbi52dWUiOwoKY29uc3QgX2N1c3RvbWVyU2VydmljZSA9IG5ldyBDdXN0b21lclNlcnZpY2UoKTsKY29uc3QgX2ludmVudG9yeVNlcnZpY2UgPSBuZXcgSW52ZW50b3J5U2VydmljZSgpOwpjb25zdCBfaW52b2ljZVNlcnZpY2UgPSBuZXcgSW52b2ljZVNlcnZpY2UoKTsKCkBDb21wb25lbnQoewogIG5hbWU6ICJDcmVhdGVJbnZvaWNlIiwKICBjb21wb25lbnRzOiB7IFNvbGFyQnV0dG9uIH0KfSkKZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ3JlYXRlSW52b2ljZSBleHRlbmRzIFZ1ZSB7CiAgaW52b2ljZVN0ZXAgPSAxOwogIGludm9pY2U6IEludm9pY2UgPSB7CiAgICBjcmVhdGVkT246IG5ldyBEYXRlKCksCiAgICBjdXN0b21lcklkOiAwLAogICAgbGluZUl0ZW1zOiBbXSwKICAgIHVwZGF0ZWRPbjogbmV3IERhdGUoKQogIH07CiAgc2VsZWN0ZWRDdXN0b21lcjogQ3VzdG9tZXI7CiAgc2VsZWN0ZWRDdXN0b21lcklkID0gMDsKICBjdXN0b21lcnM6IEN1c3RvbWVyW10gPSBbXTsKICBpbnZlbnRvcnk6IFByb2R1Y3RJbnZlbnRvcnlbXSA9IFtdOwogIGxpbmVJdGVtczogTGluZUl0ZW1bXSA9IFtdOwogIG5ld0l0ZW06IExpbmVJdGVtID0gewogICAgcHJvZHVjdDogdW5kZWZpbmVkLAogICAgcXVhbnRpdHk6IDAKICB9OwogIGFkZExpbmVJdGVtKCkgewogICAgY29uc3QgbmV3SXRlbTogTGluZUl0ZW0gPSB7CiAgICAgIHByb2R1Y3Q6IHRoaXMubmV3SXRlbS5wcm9kdWN0LAogICAgICBxdWFudGl0eTogTnVtYmVyKHRoaXMubmV3SXRlbS5xdWFudGl0eSkKICAgIH07CiAgICBjb25zdCBleGlzdGluZ0l0ZW1zID0gdGhpcy5saW5lSXRlbXMubWFwKGl0ZW0gPT4gaXRlbS5wcm9kdWN0LmlkKTsKCiAgICBpZiAoZXhpc3RpbmdJdGVtcy5pbmNsdWRlcyhuZXdJdGVtLnByb2R1Y3QuaWQpKSB7CiAgICAgIGNvbnN0IGxpbmVJdGVtID0gdGhpcy5saW5lSXRlbXMuZmluZCgKICAgICAgICBpdGVtID0+IGl0ZW0ucHJvZHVjdC5pZCA9PT0gbmV3SXRlbS5wcm9kdWN0LmlkCiAgICAgICk7CiAgICAgIGxldCBjdXJyZW50UXVhbnRpdHkgPSBOdW1iZXIobGluZUl0ZW0ucXVhbnRpdHkpOwogICAgICBjb25zdCB1cGRhdGVkUXVhbnRpdHkgPSAoY3VycmVudFF1YW50aXR5ICs9IG5ld0l0ZW0ucXVhbnRpdHkpOwogICAgICBsaW5lSXRlbS5xdWFudGl0eSA9IHVwZGF0ZWRRdWFudGl0eTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMubGluZUl0ZW1zLnB1c2godGhpcy5uZXdJdGVtKTsKICAgIH0KICAgIHRoaXMubmV3SXRlbSA9IHsgcHJvZHVjdDogdW5kZWZpbmVkLCBxdWFudGl0eTogMCB9OwogIH0KICBmaW5hbGl6ZU9yZGVyKCkgewogICAgdGhpcy5pbnZvaWNlU3RlcCA9IDM7CiAgfQogIHN0YXJ0T3ZlcigpIHsKICAgIHRoaXMuaW52b2ljZSA9IHsgY3VzdG9tZXJJZDogMCwgbGluZUl0ZW1zOiBbXSB9OwogICAgdGhpcy5pbnZvaWNlU3RlcCA9IDE7CiAgfQogIGdldCBjYW5Hb05leHQoKSB7CiAgICBpZiAodGhpcy5pbnZvaWNlU3RlcCA9PT0gMSkgcmV0dXJuIHRoaXMuc2VsZWN0ZWRDdXN0b21lcklkICE9PSAwOwogICAgaWYgKHRoaXMuaW52b2ljZVN0ZXAgPT09IDIpIHJldHVybiB0aGlzLmxpbmVJdGVtcy5sZW5ndGg7CiAgICBpZiAodGhpcy5pbnZvaWNlU3RlcCA9PT0gMykgcmV0dXJuIGZhbHNlOwogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgZ2V0IGNhbkdvUHJldigpIHsKICAgIHJldHVybiB0aGlzLmludm9pY2VTdGVwICE9PSAxOwogIH0KICBnZXQgcnVubmluZ1RvdGFsKCkgewogICAgcmV0dXJuIHRoaXMubGluZUl0ZW1zLnJlZHVjZSgKICAgICAgKGN1cnJlbnQsIG1lbW8pID0+IGN1cnJlbnQgKyBtZW1vWyJwcm9kdWN0Il1bInByaWNlIl0gKiBtZW1vWyJxdWFudGl0eSJdLAogICAgICAwCiAgICApOwogIH0KICBnZXQgc2VsZWN0ZWRDdXN0b21lcigpIHsKICAgIHJldHVybiB0aGlzLmN1c3RvbWVycy5maW5kKGMgPT4gYy5pZCA9PT0gdGhpcy5zZWxlY3RlZEN1c3RvbWVySWQpOwogIH0KICBwcmV2KCk6IHZvaWQgewogICAgaWYgKHRoaXMuaW52b2ljZVN0ZXAgPT09IDEpIHJldHVybjsKICAgIHRoaXMuaW52b2ljZVN0ZXAgLT0gMTsKICB9CiAgbmV4dCgpOiB2b2lkIHsKICAgIGlmICh0aGlzLmludm9pY2VTdGVwID09PSAzKSByZXR1cm47CiAgICB0aGlzLmludm9pY2VTdGVwICs9IDE7CiAgfQogIGFzeW5jIHN1Ym1pdEludm9pY2UoKSB7CiAgICB0aGlzLmludm9pY2UgPSB7CiAgICAgIGN1c3RvbWVyOiB0aGlzLnNlbGVjdGVkQ3VzdG9tZXJJZCwKICAgICAgbGluZUl0ZW1zOiB0aGlzLmxpbmVJdGVtcwogICAgfTsKCiAgICBhd2FpdCBfaW52b2ljZVNlcnZpY2UubWFrZU5ld0ludm9pY2UodGhpcy5pbnZvaWNlKTsKICB9CiAgYXN5bmMgaW5pdGlhbGl6ZSgpOiBQcm9taXNlPHZvaWQ+IHsKICAgIHRoaXMuY3VzdG9tZXJzID0gYXdhaXQgX2N1c3RvbWVyU2VydmljZS5nZXRDdXN0b21lcnMoKTsKICAgIHRoaXMuaW52ZW50b3J5ID0gYXdhaXQgX2ludmVudG9yeVNlcnZpY2UuZ2V0SW52ZW50b3J5KCk7CiAgfQogIGFzeW5jIGNyZWF0ZWQoKSB7CiAgICBhd2FpdCB0aGlzLmluaXRpYWxpemUoKTsKICB9Cn0K"},{"version":3,"sources":["CreateInvoice.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsKA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CreateInvoice.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"create-invoice-container\">\n    <h1 id=\"invoiceTitle\">Create Invoice</h1>\n    <hr />\n\n    <div class=\"invoice-step\" v-if=\"invoiceStep === 1\">\n      <h2>Step 1: Select Customer</h2>\n      <div v-if=\"customers.length\" class=\"invoice-step-detail\">\n        <label for=\"customer\">Customer:</label>\n        <select\n          v-model=\"selectedCustomerId\"\n          class=\"invoice-customers\"\n          id=\"customer\"\n        >\n          <option disabled value=\"\">Please select a Customer</option>\n          <option v-for=\"c in customers\" :value=\"c.id\" :key=\"c.id\">{{\n            c.firstName + \" \" + c.lastName\n          }}</option>\n        </select>\n      </div>\n    </div>\n    <div class=\"invoice-step\" v-if=\"invoiceStep === 2\">\n      <h2>Step 2: Create Order</h2>\n      <div v-if=\"inventory.length\" class=\"invoice-step-detail\">\n        <label for=\"product\">Product:</label>\n        <select\n          v-model=\"newItem.product\"\n          class=\"invoice-line-item\"\n          id=\"product\"\n        >\n          <option disabled value=\"\">Please select a Product</option>\n          <option v-for=\"i in inventory\" :value=\"i.product\" :key=\"i.product.id\">\n            {{ i.product.name }}\n          </option>\n        </select>\n        <label for=\"quantity\">Quantity</label>\n        <input v-model=\"newItem.quantity\" id=\"quantity\" type=\"number\" min=\"0\" />\n      </div>\n\n      <div class=\"invoice-item-actions\">\n        <solar-button\n          :disabled=\"!newItem.product || !newItem.quantity\"\n          @button:click=\"addLineItem\"\n          >Add Line Item</solar-button\n        >\n        <solar-button\n          :disabled=\"!lineItems.length\"\n          @button:click=\"finalizeOrder\"\n          >Finalize Order</solar-button\n        >\n      </div>\n      <div class=\"invoice-order-list\" v-if=\"lineItems.length\">\n        <div class=\"runningTotal\">\n          <h3>Running Total:</h3>\n          {{ runningTotal | price }}\n        </div>\n        <hr />\n        <table class=\"table\">\n          <thead>\n            <th>Product</th>\n            <th>Description</th>\n            <th>Qty.</th>\n            <th>Price</th>\n            <th>Subtotal</th>\n          </thead>\n          <tr\n            v-for=\"lineItem in lineItems\"\n            :key=\"`index_${lineItem.product.id}`\"\n          >\n            <td>{{ lineItem.product.name }}</td>\n            <td>{{ lineItem.product.description }}</td>\n            <td>{{ lineItem.quantity }}</td>\n            <td>{{ lineItem.product.price }}</td>\n            <td>{{ (lineItem.product.price * lineItem.quantity) | price }}</td>\n          </tr>\n        </table>\n      </div>\n    </div>\n    <div class=\"invoice-step\" v-if=\"invoiceStep === 3\">\n      <h2>Step 3: Review and Submit</h2>\n      <solar-button @button:click=\"submitInvoice\">Submit Invoice</solar-button>\n      <hr />\n      <div class=\"invoice-step-detail\" id=\"invoice\" ref=\"invoice\">\n        <div class=\"invoice-logo\">\n          <img id=\"imgLogo\" alt=\"Solar Coffee logo\" src=\"../assets/logo.png\" />\n          <h3>1337 Solar Lane</h3>\n          <h3>San Somewhere, CA 900000</h3>\n          <h3>USA</h3>\n\n          <div class=\"invoice-order-list\" v-if=\"lineItems.length\">\n            <div class=\"invoice-header\">\n              <h3>Invoice: {{ new Date() | humanizeDate }}</h3>\n              <h3>\n                Customer:\n                {{\n                  this.selectedCustomer.firstName +\n                    \" \" +\n                    this.selectedCustomer.lastName\n                }}\n              </h3>\n              <h3>\n                Address: {{ this.selectedCustomer.primaryAddress.addressLine1 }}\n              </h3>\n              <h3 v-if=\"this.selectedCustomer.primaryAddress.addressLine2\">\n                {{ this.selectedCustomer.primaryAddress.addressLine2 }}\n              </h3>\n              <h3>\n                {{ this.selectedCustomer.primaryAddress.city }}\n                {{ this.selectedCustomer.primaryAddress.state }}\n                {{ this.selectedCustomer.primaryAddress.postalCode }}\n              </h3>\n              <h3>\n                {{ this.selectedCustomer.primaryAddress.country }}\n              </h3>\n            </div>\n            <table class=\"table\">\n              <thead>\n                <tr>\n                  <th>Product</th>\n                  <th>Description</th>\n                  <th>Qty.</th>\n                  <th>Price</th>\n                  <th>Subtotal</th>\n                </tr>\n              </thead>\n              <tr\n                v-for=\"lineItem in lineItems\"\n                :key=\"`index_${lineItem.product.id}`\"\n              >\n                <td>{{ lineItem.product.name }}</td>\n                <td>{{ lineItem.product.description }}</td>\n                <td>{{ lineItem.quantity }}</td>\n                <td>{{ lineItem.product.price }}</td>\n                <td>\n                  {{ (lineItem.product.price * lineItem.quantity) | price }}\n                </td>\n              </tr>\n              <tr>\n                <th colspan=\"4\"></th>\n                <th>Grand Total</th>\n              </tr>\n              <tfoot>\n                <tr>\n                  <td colspan=\"4\" class=\"due\">Balance due upon receipt:</td>\n                  <td class=\"price-final\">{{ runningTotal | price }}</td>\n                </tr>\n              </tfoot>\n            </table>\n          </div>\n        </div>\n      </div>\n    </div>\n    <hr />\n    <div class=\"invoice-step-actions\">\n      <solar-button @button:click=\"prev\" :disabled=\"!canGoPrev\"\n        >Previous</solar-button\n      >\n      <solar-button @button:click=\"next\" :disabled=\"!canGoNext\"\n        >Next</solar-button\n      >\n      <solar-button @button:click=\"startOver\">Start Over</solar-button>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { Component, Vue } from \"vue-property-decorator\";\nimport { Invoice, LineItem } from \"@/types/Invoice\";\nimport { Customer } from \"@/types/Customer\";\nimport { ProductInventory } from \"@/types/Product\";\nimport { CustomerService, InventoryService, InvoiceService } from \"@/services\";\nimport SolarButton from \"@/components/SolarButton.vue\";\n\nconst _customerService = new CustomerService();\nconst _inventoryService = new InventoryService();\nconst _invoiceService = new InvoiceService();\n\n@Component({\n  name: \"CreateInvoice\",\n  components: { SolarButton }\n})\nexport default class CreateInvoice extends Vue {\n  invoiceStep = 1;\n  invoice: Invoice = {\n    createdOn: new Date(),\n    customerId: 0,\n    lineItems: [],\n    updatedOn: new Date()\n  };\n  selectedCustomer: Customer;\n  selectedCustomerId = 0;\n  customers: Customer[] = [];\n  inventory: ProductInventory[] = [];\n  lineItems: LineItem[] = [];\n  newItem: LineItem = {\n    product: undefined,\n    quantity: 0\n  };\n  addLineItem() {\n    const newItem: LineItem = {\n      product: this.newItem.product,\n      quantity: Number(this.newItem.quantity)\n    };\n    const existingItems = this.lineItems.map(item => item.product.id);\n\n    if (existingItems.includes(newItem.product.id)) {\n      const lineItem = this.lineItems.find(\n        item => item.product.id === newItem.product.id\n      );\n      let currentQuantity = Number(lineItem.quantity);\n      const updatedQuantity = (currentQuantity += newItem.quantity);\n      lineItem.quantity = updatedQuantity;\n    } else {\n      this.lineItems.push(this.newItem);\n    }\n    this.newItem = { product: undefined, quantity: 0 };\n  }\n  finalizeOrder() {\n    this.invoiceStep = 3;\n  }\n  startOver() {\n    this.invoice = { customerId: 0, lineItems: [] };\n    this.invoiceStep = 1;\n  }\n  get canGoNext() {\n    if (this.invoiceStep === 1) return this.selectedCustomerId !== 0;\n    if (this.invoiceStep === 2) return this.lineItems.length;\n    if (this.invoiceStep === 3) return false;\n    return false;\n  }\n\n  get canGoPrev() {\n    return this.invoiceStep !== 1;\n  }\n  get runningTotal() {\n    return this.lineItems.reduce(\n      (current, memo) => current + memo[\"product\"][\"price\"] * memo[\"quantity\"],\n      0\n    );\n  }\n  get selectedCustomer() {\n    return this.customers.find(c => c.id === this.selectedCustomerId);\n  }\n  prev(): void {\n    if (this.invoiceStep === 1) return;\n    this.invoiceStep -= 1;\n  }\n  next(): void {\n    if (this.invoiceStep === 3) return;\n    this.invoiceStep += 1;\n  }\n  async submitInvoice() {\n    this.invoice = {\n      customer: this.selectedCustomerId,\n      lineItems: this.lineItems\n    };\n\n    await _invoiceService.makeNewInvoice(this.invoice);\n  }\n  async initialize(): Promise<void> {\n    this.customers = await _customerService.getCustomers();\n    this.inventory = await _inventoryService.getInventory();\n  }\n  async created() {\n    await this.initialize();\n  }\n}\n</script>\n\n<style scoped lang=\"scss\">\n@import \"src/scss/global.scss\";\n.invoice-step-actions {\n  display: flex;\n  width: 100%;\n}\n.invoice-step {\n}\n.invoice-step-detail {\n  margin: 1.2rem;\n}\n.invoice-order-list {\n  margin-top: 1.2rem;\n  padding: 0.8rem;\n\n  .line-item {\n    display: flex;\n    border-bottom: 1px dashed #ccc;\n    padding: 0.8rem;\n  }\n\n  .item-col {\n    flex-grow: 1;\n  }\n}\n\n.invoice-item-actions {\n  font-weight: bold;\n}\n\n.price-pre-tax {\n  font-weight: bold;\n}\n\n.price-final {\n  font-weight: bold;\n  color: $solar-green;\n}\n\n.due {\n  font-weight: bold;\n}\n\n.invoice-header {\n  width: 100%;\n  margin-bottom: 1.2rem;\n}\n\n.invoice-logo {\n  padding-top: 1.4rem;\n  text-align: center;\n\n  img {\n    width: 280px;\n  }\n}\n</style>\n"]}]}